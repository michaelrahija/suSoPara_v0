format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
#########################################################
#-SUM comment set in seconds to variable response time ##
#########################################################
#create vector of ids where there is a comment set right after answer
commentrows <- c()
for(i in 1:nrow(temp)){
if(temp$action[i] == "AnswerSet" & temp$action[i+1] == "CommentSet"){
commentrows <- append(commentrows, temp$actionOrder[i])
} else {
commentrows <- append(commentrows, FALSE)
}
}
commentrows <- commentrows[commentrows != 0]
#sum secs since last action for id'ed rows, and put NA for comments
for(i in 1:commentrows){
temp$SecsSinceLastAction[commentrows[i]] <- difftime(temp$SecsSinceLastAction[commentrows[i]],
temp$SecsSinceLastAction[commentrows[i]]+2)
temp$SecsSinceLastAction[temp$action == "CommentSet"] <- NA
}
colnames(temp)
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
#- imported file in order of action, not all action contain time
#so later sorting doesn't work.
temp$actionOrder <- 1:nrow(temp)
#-Test to make sure correct file
#correct columns
if(length(colnames(temp)) != 9) stop("Invalid number of columns")
#- add column to id interview
interviewid <- gsub(".+/paradata/","",dir)
interviewid <- gsub(".tab","",interviewid)
source("R/extractRight.R")
interviewid <- extractRight(interviewid, n = 6)
temp$id <- rep(interviewid, times = nrow(temp))
#- clean column names
colnames(temp) <- c("action",
"user",
"role",
"date",
"time",
"variable_name",
"response",
"rosterRowRef",
"actionOrder",
"id")
#-sort in more readable way
temp <- select(temp,
id,
actionOrder,
action,
role,
user,
variable_name,
rosterRowRef,
date,
time,
response
)
#- add column for posix
temp$posix <- paste0(temp$date, " ", temp$time)
temp$posix <- as.POSIXct(temp$posix,
format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
#########################################################
#-SUM comment set in seconds to variable response time ##
#########################################################
#create vector of ids where there is a comment set right after answer
commentrows <- c()
for(i in 1:nrow(temp)){
if(temp$action[i] == "AnswerSet" & temp$action[i+1] == "CommentSet"){
commentrows <- append(commentrows, temp$actionOrder[i])
} else {
commentrows <- append(commentrows, FALSE)
}
}
commentrows <- commentrows[commentrows != 0]
#sum secs since last action for id'ed rows, and put NA for comments
for(i in 1:commentrows){
temp$SecsSinceLastAction[commentrows[i]] <- difftime(temp$posix[commentrows[i]],
temp$posix[commentrows[i]]+2)
temp$SecsSinceLastAction[temp$action == "CommentSet"] <- NA
}
View(temp)
commentrows
for(i in 1:commentrows){
temp$SecsSinceLastAction[commentrows[i]] <- difftime(temp$posix[commentrows[i]],
temp$posix[commentrows[i]]+2)
temp$SecsSinceLastAction[temp$action == "CommentSet"] <- NA
}
View(temp)
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
#- imported file in order of action, not all action contain time
#so later sorting doesn't work.
temp$actionOrder <- 1:nrow(temp)
#-Test to make sure correct file
#correct columns
if(length(colnames(temp)) != 9) stop("Invalid number of columns")
#- add column to id interview
interviewid <- gsub(".+/paradata/","",dir)
interviewid <- gsub(".tab","",interviewid)
source("R/extractRight.R")
interviewid <- extractRight(interviewid, n = 6)
temp$id <- rep(interviewid, times = nrow(temp))
#- clean column names
colnames(temp) <- c("action",
"user",
"role",
"date",
"time",
"variable_name",
"response",
"rosterRowRef",
"actionOrder",
"id")
#-sort in more readable way
temp <- select(temp,
id,
actionOrder,
action,
role,
user,
variable_name,
rosterRowRef,
date,
time,
response
)
#- add column for posix
temp$posix <- paste0(temp$date, " ", temp$time)
temp$posix <- as.POSIXct(temp$posix,
format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions can't compute time
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
#########################################################
#-SUM comment set in seconds to variable response time ##
#########################################################
#create vector of ids where there is a comment set right after answer
commentrows <- c()
for(i in 1:nrow(temp)){
if(temp$action[i] == "AnswerSet" & temp$action[i+1] == "CommentSet"){
commentrows <- append(commentrows, temp$actionOrder[i])
} else {
commentrows <- append(commentrows, FALSE)
}
}
commentrows <- commentrows[commentrows != 0]
#sum secs since last action for id'ed rows, and put NA for comments
for(i in 1:commentrows){
temp$SecsSinceLastAction[commentrows[i]] <- difftime(temp$posix[commentrows[i]+2],
temp$posix[commentrows[i]])
temp$SecsSinceLastAction[temp$action == "CommentSet"] <- NA
}
#script to look at SuSo paradata
library(tidyr)
library(dplyr)
library(foreign)
library(readr)
library(reshape)
sys <- Sys.info()
if(sys[5] == "x86_64"){
wdir = "~/Dropbox/suSoPara" #Mac
para = "~/Dropbox/suSoPara_data/uganda_para/"
} else if (sys[6]=="Rahija") {
wdir = "C:/Users/rahija/Dropbox/suSoPara" #FAO PC
para = "C:/Users/rahija/Dropbox/suSoPara/uganda_para/"
#} else if (#insert CARLOTTA condition){
#wdir =
#para =
} else {
stop("Implement location for current user!")
}
setwd(wdir)
#Import paradata, add column to id interview,
#create posix column for actions
p.files <- list.files(para, pattern = ".tab")
p.files <- paste0(para,p.files)
# Create table with all actions
source("R/actionTable.R")
#para.list <- list()
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
temp.df <- actionTable(dir = p.files[i])
para.list[[i]] <-  temp.df
}})
para.df <- data.table::rbindlist(para.list)
p.files
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
temp.df <- actionTable(dir = p.files[i])
para.list[[i]] <-  temp.df
}})
dir = para.list[5]
dir
dir = p.files[15]
dir
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
head(temp)
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
#- imported file in order of action, not all action contain time
#so later sorting doesn't work.
temp$actionOrder <- 1:nrow(temp)
#-Test to make sure correct file
#correct columns
if(length(colnames(temp)) != 9) stop("Invalid number of columns")
#- add column to id interview
interviewid <- gsub(".+/paradata/","",dir)
interviewid <- gsub(".tab","",interviewid)
source("R/extractRight.R")
interviewid <- extractRight(interviewid, n = 6)
temp$id <- rep(interviewid, times = nrow(temp))
#- clean column names
colnames(temp) <- c("action",
"user",
"role",
"date",
"time",
"variable_name",
"response",
"rosterRowRef",
"actionOrder",
"id")
#-sort in more readable way
temp <- select(temp,
id,
actionOrder,
action,
role,
user,
variable_name,
rosterRowRef,
date,
time,
response
)
#- add column for posix
temp$posix <- paste0(temp$date, " ", temp$time)
temp$posix <- as.POSIXct(temp$posix,
format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions can't compute time
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
unique(temp$action)
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
temp.df <- actionTable(dir = p.files[i])
para.list[[i]] <-  temp.df
}})
#create posix column for actions
p.files <- list.files(para, pattern = ".tab")
p.files <- paste0(para,p.files)
# Create table with all actions
source("R/actionTable.R")
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
i
temp.df <- actionTable(dir = p.files[i])
para.list[[i]] <-  temp.df
}})
#create posix column for actions
p.files <- list.files(para, pattern = ".tab")
p.files <- paste0(para,p.files)
# Create table with all actions
source("R/actionTable.R")
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
i
temp.df <- actionTable(dir = p.files[1])
para.list[[i]] <-  temp.df
}})
p.files <- list.files(para, pattern = ".tab")
p.files <- paste0(para,p.files)
# Create table with all actions
source("R/actionTable.R")
system.time({
#para.list <- vector(mode = "list", length = length(p.files))
para.list <- list()
for(i in 1:length(p.files)){
i
temp.df <- actionTable(dir = p.files[i])
para.list[[i]] <-  temp.df
}})
para.df <- data.table::rbindlist(para.list)
str(para.list)
length(para.list)
dir = p.files[10]
#if(dir == NA) stop("Must add a directory!")
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
#- imported file in order of action, not all action contain time
#so later sorting doesn't work.
temp$actionOrder <- 1:nrow(temp)
#-Test to make sure correct file
#correct columns
if(length(colnames(temp)) != 9) stop("Invalid number of columns")
#- add column to id interview
interviewid <- gsub(".+/paradata/","",dir)
interviewid <- gsub(".tab","",interviewid)
source("R/extractRight.R")
interviewid <- extractRight(interviewid, n = 6)
temp$id <- rep(interviewid, times = nrow(temp))
#- clean column names
colnames(temp) <- c("action",
"user",
"role",
"date",
"time",
"variable_name",
"response",
"rosterRowRef",
"actionOrder",
"id")
#-sort in more readable way
temp <- select(temp,
id,
actionOrder,
action,
role,
user,
variable_name,
rosterRowRef,
date,
time,
response
)
#- add column for posix
temp$posix <- paste0(temp$date, " ", temp$time)
temp$posix <- as.POSIXct(temp$posix,
format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions can't compute time
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
#########################################################
#-SUM comment set in seconds to variable response time ##
#########################################################
if("CommentSet" %in% unique(temp$action)){
#create vector of ids where there is a comment set right after answer
commentrows <- c()
for(i in 1:nrow(temp)){
if(temp$action[i] == "AnswerSet" & temp$action[i+1] == "CommentSet"){
commentrows <- append(commentrows, temp$actionOrder[i])
} else {
commentrows <- append(commentrows, FALSE)
}
}
commentrows <- commentrows[commentrows != 0]
#sum secs since last action for id'ed rows, and put NA for comments
for(i in 1:commentrows){
temp$SecsSinceLastAction[commentrows[i]] <- difftime(temp$posix[commentrows[i]+2],
temp$posix[commentrows[i]])
temp$SecsSinceLastAction[temp$action == "CommentSet"] <- NA
}
}
dir
temp <- read.delim(dir,
header = FALSE,
sep = "\t",
stringsAsFactors = FALSE)
#- imported file in order of action, not all action contain time
#so later sorting doesn't work.
temp$actionOrder <- 1:nrow(temp)
#-Test to make sure correct file
#correct columns
if(length(colnames(temp)) != 9) stop("Invalid number of columns")
#- add column to id interview
interviewid <- gsub(".+/paradata/","",dir)
interviewid <- gsub(".tab","",interviewid)
source("R/extractRight.R")
interviewid <- extractRight(interviewid, n = 6)
temp$id <- rep(interviewid, times = nrow(temp))
#- clean column names
colnames(temp) <- c("action",
"user",
"role",
"date",
"time",
"variable_name",
"response",
"rosterRowRef",
"actionOrder",
"id")
#-sort in more readable way
temp <- select(temp,
id,
actionOrder,
action,
role,
user,
variable_name,
rosterRowRef,
date,
time,
response
)
#- add column for posix
temp$posix <- paste0(temp$date, " ", temp$time)
temp$posix <- as.POSIXct(temp$posix,
format = "%m/%d/%Y %H:%M:%S",
tz = "Africa/Kampala")
#- sort rows, by time, and add order column
temp <- arrange(temp, posix)
#-compute item response times
times <- c()
for(i in 1:nrow(temp)){
#if first iteration, just put 0 b/c first questions can't compute time
if(i == 1){
time.temp <- NA
} else {
time.temp <- difftime(temp$posix[i],temp$posix[i-1])
}
times <- append(times, time.temp)
}
temp$SecsSinceLastAction <- times
temp <- arrange(temp, id, actionOrder)
"CommentSet" %in% unique(temp$action)
filter(temp, action == "CommentSEt")
filter(temp, action == "CommentSet")
View(temp)
